(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53674,(e,t,r)=>{t.exports=e.r(36518)},5860,e=>{"use strict";var t=e.i(52608),r=e.i(43942),s=e.i(53674),n=e.i(35683),l=e.i(95323),a=e.i(93768),c=e.i(67879),i=e.i(60885);function u(){let e=(0,s.useRouter)(),{showLoading:u,hideLoading:o,showLoadingWithProgress:d,updateProgress:m}=(0,i.useLoading)(),[x,h]=(0,r.useState)(null),[f,g]=(0,r.useState)([]),[b,y]=(0,r.useState)(!1),[j,p]=(0,r.useState)(null),[v,N]=(0,r.useState)(!0),[R,S]=(0,r.useState)(!1),I=(0,r.useRef)(null),w=(0,r.useRef)(0),C=(0,r.useRef)(!1),T=(0,r.useRef)(!1),k=async()=>{if(!C.current){C.current=!0;try{d("加载中..."),p(null),m(20);let e=await (0,c.fetchRandomImages)(0,20);m(80),g(e),w.current=20,N(e.length>=20),m(100)}catch(e){p("加载图片失败，请稍后重试"),console.error("Failed to load images:",e)}finally{setTimeout(()=>{o(),C.current=!1},300)}}},O=async()=>{if(!b&&v&&!C.current){C.current=!0;try{y(!0);let e=await (0,c.fetchRandomImages)(w.current,20);g(t=>{let r=new Set(t.map(e=>e.id)),s=e.filter(e=>!r.has(e.id));return[...t,...s]}),w.current+=20,N(e.length>=20)}catch(e){console.error("Failed to load more images:",e)}finally{y(!1),C.current=!1}}};return((0,r.useEffect)(()=>{T.current||((T.current=!0,localStorage.getItem("auth_token"))?(S(!0),k()):e.push("/login"))},[e]),(0,r.useEffect)(()=>{if(!R)return;let e=new IntersectionObserver(e=>{e[0].isIntersecting&&v&&!b&&O()},{threshold:.01,rootMargin:"200px"});return I.current&&e.observe(I.current),()=>{I.current&&e.unobserve(I.current)}},[R,v,b]),j)?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"加载失败"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:j}),(0,t.jsx)("button",{onClick:k,className:"bg-black text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-800 transition",children:"重新加载"})]})}):R?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[(0,t.jsx)(n.Header,{}),(0,t.jsx)(l.GalleryGrid,{items:f,onItemClick:e=>h(e)}),b&&(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}),!v&&f.length>0&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"没有更多图片了"}),(0,t.jsx)("div",{ref:I,className:"h-20"}),(0,t.jsx)(a.ImageModal,{selectedItem:x,onClose:()=>h(null)})]}):null}e.s(["default",()=>u])}]);