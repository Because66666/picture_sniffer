(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53674,(e,t,r)=>{t.exports=e.r(36518)},67879,e=>{"use strict";async function t(e){try{let t=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),r=await t.json();return r.success&&localStorage.setItem("auth_token",e),r}catch(e){throw console.error("Login error:",e),e}}function r(){let e=localStorage.getItem("auth_token"),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async function a(e=0,t=20){try{let a=await fetch(`/api/random-image?offset=${e}&limit=${t}`,{method:"GET",headers:r()});if(!a.ok){if(401===a.status)throw window.location.href="/login",Error("Unauthorized");throw Error(`HTTP error! status: ${a.status}`)}let s=await a.json();if(!s.success||!s.data)throw Error("API request failed");return s.data.map(e=>({id:e.image_id,src:o(e.image_path),category:e.category,description:e.description}))}catch(e){throw console.error("Error fetching images:",e),e}}async function s(e,t=0,a=20){try{let s=await fetch(`/api/search?keyword=${encodeURIComponent(e)}&offset=${t}&limit=${a}`,{method:"GET",headers:r()});if(!s.ok){if(401===s.status)throw window.location.href="/login",Error("Unauthorized");throw Error(`HTTP error! status: ${s.status}`)}let i=await s.json();if(!i.success||!i.data)throw Error("API request failed");return i.data.map(e=>({id:e.image_id,src:o(e.image_path),category:e.category,description:e.description}))}catch(e){throw console.error("Error searching images:",e),e}}async function i(e){try{let t=await fetch("/api/describe-image",{method:"POST",headers:r(),body:JSON.stringify({image_id:e})});if(!t.ok){if(401===t.status)throw window.location.href="/login",Error("Unauthorized");throw Error(`HTTP error! status: ${t.status}`)}let a=await t.json();if(!a.success)throw Error("API request failed");return a.data}catch(e){throw console.error("Error describing image:",e),e}}function o(e){return`/${e.replace(/\\/g,"/")}`}e.i(35939),e.s(["describeImage",()=>i,"fetchRandomImages",()=>a,"login",()=>t,"searchImages",()=>s],67879)},41601,e=>{"use strict";var t=e.i(52608),r=e.i(43942),a=e.i(53674),s=e.i(35683),i=e.i(95323),o=e.i(93768),n=e.i(67879);let c=(0,e.i(87722).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var l=e.i(60885);function d(){let e=(0,a.useSearchParams)().get("q")||"",{showLoading:d,hideLoading:h,showLoadingWithProgress:m,updateProgress:u}=(0,l.useLoading)(),[g,f]=(0,r.useState)(null),[x,y]=(0,r.useState)([]),[p,w]=(0,r.useState)(!1),[j,b]=(0,r.useState)(null),[N,v]=(0,r.useState)(0),[T,E]=(0,r.useState)(!0),I=(0,r.useRef)(null);(0,r.useEffect)(()=>{e&&S()},[e]),(0,r.useEffect)(()=>{let e=new IntersectionObserver(e=>{e[0].isIntersecting&&T&&!p&&k()},{threshold:.1});return I.current&&e.observe(I.current),()=>{I.current&&e.unobserve(I.current)}},[T,p]);let S=async()=>{try{m("搜索中..."),b(null),u(20);let t=await (0,n.searchImages)(e,0,10);u(80),y(t),v(10),E(t.length>=10),u(100)}catch(e){b("搜索失败，请稍后重试"),console.error("Failed to search images:",e)}finally{setTimeout(()=>h(),300)}},k=async()=>{try{w(!0);let t=await (0,n.searchImages)(e,N,10);y(e=>{let r=new Set(e.map(e=>e.id)),a=t.filter(e=>!r.has(e.id));return[...e,...a]}),v(e=>e+10),E(t.length>=10)}catch(e){console.error("Failed to load more images:",e)}finally{w(!1)}};return j?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"搜索失败"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:j}),(0,t.jsx)("button",{onClick:S,className:"bg-black text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-800 transition",children:"重新搜索"})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[(0,t.jsx)(s.Header,{}),(0,t.jsx)("div",{className:"max-w-4xl mx-auto mb-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:()=>window.location.href="/",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:(0,t.jsx)(c,{size:20})}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:["搜索结果: ",(0,t.jsxs)("span",{className:"text-gray-600",children:['"',e,'"']})]})]})}),0===x.length?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("img",{src:"/search.png",alt:"搜索",className:"w-24 h-24 mx-auto mb-4 opacity-60"}),(0,t.jsx)("p",{className:"text-gray-600 text-lg",children:"没有找到相关图片"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.GalleryGrid,{items:x,onItemClick:e=>f(e)}),p&&(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}),!T&&x.length>0&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"没有更多图片了"}),(0,t.jsx)("div",{ref:I,className:"h-1"})]}),(0,t.jsx)(o.ImageModal,{selectedItem:g,onClose:()=>f(null),onDescriptionUpdate:(e,t)=>{y(r=>r.map(r=>r.id===e?{...r,description:t}:r)),g&&g.id===e&&f(e=>e?{...e,description:t}:null)}})]})}function h(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}),children:(0,t.jsx)(d,{})})}e.s(["default",()=>h],41601)}]);