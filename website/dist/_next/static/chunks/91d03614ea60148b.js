(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53674,(e,t,r)=>{t.exports=e.r(36518)},5860,e=>{"use strict";var t=e.i(52608),r=e.i(43942),n=e.i(53674),s=e.i(35683),a=e.i(95323),l=e.i(93768),c=e.i(67879),i=e.i(60885);function u(){let e=(0,n.useRouter)(),{showLoading:u,hideLoading:o,showLoadingWithProgress:d,updateProgress:m}=(0,i.useLoading)(),[h,x]=(0,r.useState)(null),[g,f]=(0,r.useState)([]),[b,p]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[v,N]=(0,r.useState)(!0),[R,S]=(0,r.useState)(!1),I=(0,r.useRef)(null),w=(0,r.useRef)(0),T=(0,r.useRef)(!1),C=(0,r.useRef)(!1),k=(0,r.useRef)(new Set),O=(0,r.useRef)(!1),U=async()=>{if(!T.current){T.current=!0,k.current.clear(),O.current=!1;try{d("加载中..."),j(null),m(20);let e=await (0,c.fetchRandomImages)(0,20);m(60),f(e),w.current=20,N(e.length>=20),O.current=!0,0===e.length&&(m(100),setTimeout(()=>{o()},300),T.current=!1)}catch(e){j("加载图片失败，请稍后重试"),console.error("Failed to load images:",e),o(),T.current=!1}}},A=async()=>{if(!b&&v&&!T.current){T.current=!0;try{p(!0);let e=await (0,c.fetchRandomImages)(w.current,20);f(t=>{let r=new Set(t.map(e=>e.id)),n=e.filter(e=>!r.has(e.id));return[...t,...n]}),w.current+=20,N(e.length>=20)}catch(e){console.error("Failed to load more images:",e)}finally{p(!1),T.current=!1}}};return((0,r.useEffect)(()=>{C.current||((C.current=!0,localStorage.getItem("auth_token"))?(S(!0),U()):e.push("/login"))},[e]),(0,r.useEffect)(()=>{if(!R)return;let e=new IntersectionObserver(e=>{e[0].isIntersecting&&v&&!b&&A()},{threshold:.01,rootMargin:"200px"});return I.current&&e.observe(I.current),()=>{I.current&&e.unobserve(I.current)}},[R,v,b]),y)?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"加载失败"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:y}),(0,t.jsx)("button",{onClick:U,className:"bg-black text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-800 transition",children:"重新加载"})]})}):R?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8",children:[(0,t.jsx)(s.Header,{}),(0,t.jsx)(a.GalleryGrid,{items:g,onItemClick:e=>x(e),onImageLoaded:e=>{k.current.add(e),O.current&&k.current.size===g.length&&(m(100),setTimeout(()=>{o(),T.current=!1},300))}}),b&&(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}),!v&&g.length>0&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"没有更多图片了"}),(0,t.jsx)("div",{ref:I,className:"h-20"}),(0,t.jsx)(l.ImageModal,{selectedItem:h,onClose:()=>x(null),onDescriptionUpdate:(e,t)=>{f(r=>r.map(r=>r.id===e?{...r,description:t}:r)),h&&h.id===e&&x(e=>e?{...e,description:t}:null)}})]}):null}e.s(["default",()=>u])}]);